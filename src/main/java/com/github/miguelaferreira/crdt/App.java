/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.github.miguelaferreira.crdt;

import io.dmitryivanov.crdt.LWWSet;
import io.micronaut.runtime.Micronaut;

public class App {

    public String doOfflineWork() {
        final LWWSet<String> firstLwwSet = new LWWSet<>();
        firstLwwSet.add(new LWWSet.ElementState<>(1, "dog"));
        firstLwwSet.add(new LWWSet.ElementState<>(1, "cat"));
        firstLwwSet.remove(new LWWSet.ElementState<>(2, "cat"));
        firstLwwSet.add(new LWWSet.ElementState<>(3, "ape"));

        final LWWSet<String> secondLwwSet = new LWWSet<>();
        secondLwwSet.add(new LWWSet.ElementState<>(1, "ape"));
        secondLwwSet.add(new LWWSet.ElementState<>(1, "tiger"));
        secondLwwSet.add(new LWWSet.ElementState<>(1, "cat"));
        secondLwwSet.remove(new LWWSet.ElementState<>(2, "ape"));

        // Actual test
        final LWWSet<String> resultSet = firstLwwSet.merge(secondLwwSet);

        resultSet.lookup().stream().forEach(e -> System.out.println("e = " + e));

        // output ðŸ‘‡
//        e = ape
//        e = tiger
//        e = dog

        // because ðŸ‘‡
//        final GSet<LWWSet.ElementState<String>> resultAddSet = resultSet.getAddSet();
//        final Set<LWWSet.ElementState<String>> addLookup = resultAddSet.lookup();
//        assertTrue(addLookup.size() == 5);
//        addLookup.contains(new LWWSet.ElementState<>(1, "ape"));
//        addLookup.contains(new LWWSet.ElementState<>(3, "ape"));
//        addLookup.contains(new LWWSet.ElementState<>(1, "dog"));
//        addLookup.contains(new LWWSet.ElementState<>(1, "tiger"));
//        addLookup.contains(new LWWSet.ElementState<>(1, "cat"));
//
//        final GSet<LWWSet.ElementState<String>> resultRemoveSet = resultSet.getRemoveSet();
//        final Set<LWWSet.ElementState<String>> removeLookup = resultRemoveSet.lookup();
//        assertTrue(removeLookup.size() == 2);
//        addLookup.contains(new LWWSet.ElementState<>(2, "cat"));
//        addLookup.contains(new LWWSet.ElementState<>(2, "ape"));

        return "";
    }

    public static void main(String[] args) {

//        System.out.println(new App().doOfflineWork());

        Micronaut.run(App.class);
    }
}
